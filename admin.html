<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>可视化后台 - UIUX 官网</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;padding:40px;background:#f7f9fc}
h1{margin-bottom:10px;font-size:26px}
p{margin-bottom:25px;color:#666}
.row{display:flex;align-items:center;margin-bottom:12px}
.row label{width:100px;font-weight:600}
.row input,.row textarea{flex:1;padding:8px 10px;border:1px solid #ccd8e6;border-radius:4px;font-size:14px}
.row textarea{resize:vertical;min-height:60px}
.section{background:#fff;padding:20px;border-radius:6px;margin-bottom:20px;box-shadow:0 2px 6px rgba(0,0,0,.05)}
h3{margin:0 0 10px}
button{background:#1a7cff;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;margin-right:8px}
button:hover{background:#0d68e0}
</style>
</head>
<body>
<h1>后台填表编辑器</h1>
<p>改完点底部「保存并下载 JSON」，再用该文件覆盖仓库根目录的 <code>data.json</code> 并推送即可。</p>

<form id="form"></form>
<button onclick="addService()">+ 新增服务</button>
<button onclick="saveJSON()">保存并下载 JSON</button>

<script>
let D={}; // 当前数据对象

// 初次载入
fetch('data.json')
  .then(r=>r.text())
  .then(t=>{D=JSON.parse(t); render();})
  .catch(()=>{ alert('data.json 载入失败，确认文件存在且路径正确'); });

// 渲染所有表单项
function render(){
  const f=document.getElementById('form');
  f.innerHTML='';

  // 1. 首屏
  f.innerHTML+=`
  <div class="section">
    <h3>首屏区域</h3>
    <div class="row"><label>标题</label><input name="hero.title" value="${D.hero.title}"></div>
    <div class="row"><label>描述</label><input name="hero.desc" value="${D.hero.desc}"></div>
  </div>`;

  // 2. 服务列表
  let svcHtml='<div class="section"><h3>服务列表</h3>';
  D.services.forEach((s,i)=>{
    svcHtml+=`
    <div class="row"><label>标题</label><input name="svc.title${i}" value="${s.title}"></div>
    <div class="row"><label>简介</label><textarea name="svc.summary${i}">${s.summary}</textarea></div>
    <hr style="margin:10px 0;border:none;border-top:1px solid #e8ecf0">`;
  });
  svcHtml+='</div>';
  f.innerHTML+=svcHtml;

  // 3. 作品列表
  let workHtml='<div class="section"><h3>作品列表（只改标题即可，图片换文件）</h3>';
  D.works.forEach((w,i)=>{
    workHtml+=`<div class="row"><label>标题</label><input name="work.title${i}" value="${w.title}"></div>`;
  });
  workHtml+='</div>';
  f.innerHTML+=workHtml;

  // 4. 文章列表
  let postHtml='<div class="section"><h3>文章列表（只改文字，图片换文件）</h3>';
  D.posts.forEach((p,i)=>{
    postHtml+=`
    <div class="row"><label>标题</label><input name="post.title${i}" value="${p.title}"></div>
    <div class="row"><label>摘要</label><textarea name="post.summary${i}">${p.summary}</textarea></div>
    <hr style="margin:10px 0;border:none;border-top:1px solid #e8ecf0">`;
  });
  postHtml+='</div>';
  f.innerHTML+=postHtml;
}

// 新增一条服务
function addService(){
  D.services.push({title:'新服务',summary:'描述'});
  render();
}

// 把表单值写回 D 并下载 JSON
function saveJSON(){
  // 首屏
  D.hero.title=document.querySelector('[name="hero.title"]').value;
  D.hero.desc=document.querySelector('[name="hero.desc"]').value;

  // 服务
  D.services.forEach((s,i)=>{
    s.title=document.querySelector(`[name="svc.title${i}"]`).value;
    s.summary=document.querySelector(`[name="svc.summary${i}"]`).value;
  });

  // 作品
  D.works.forEach((w,i)=>{
    w.title=document.querySelector(`[name="work.title${i}"]`).value;
  });

  // 文章
  D.posts.forEach((p,i)=>{
    p.title=document.querySelector(`[name="post.title${i}"]`).value;
    p.summary=document.querySelector(`[name="post.summary${i}"]`).value;
  });

  // 生成文件并下载
  const blob=new Blob([JSON.stringify(D,null,2)],{type:'application/json'});
  const a=document.createElement('a');
  a.download='data.json';
  a.href=URL.createObjectURL(blob);
  a.click();
}
</script>
</body>
</html>
